<script type="module">
/* IMPORTS â€” SOMENTE AQUI */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* CONFIG FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyAg421ivUVYIWikXKmUchs8KFiuKHmRcE4",
  authDomain: "convite-guilherme.firebaseapp.com",
  databaseURL: "https://convite-guilherme-default-rtdb.firebaseio.com",
  projectId: "convite-guilherme",
  storageBucket: "convite-guilherme.firebasestorage.app",
  messagingSenderId: "967694475264",
  appId: "1:967694475264:web:72078b694e3b0a1211f8e5"
};

/* FIREBASE */
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const convidadosRef = ref(db, "convidados");

/* ELEMENTOS */
const nome = document.getElementById("nome");
const resposta = document.getElementById("resposta");
const senha = document.getElementById("senha");
const admin = document.getElementById("admin");
const lista = document.getElementById("lista");

/* CONFIRMAR */
window.confirmar = function () {
  if (!nome.value || !resposta.value) {
    alert("Preencha tudo");
    return;
  }

  push(convidadosRef, {
    nome: nome.value,
    resposta: resposta.value
  });

  nome.value = "";
  resposta.value = "";
  alert("PresenÃ§a confirmada ðŸŽ‰");
};

/* ADMIN */
window.abrirAdmin = function () {
  if (senha.value !== "gui15") {
    alert("Senha incorreta");
    return;
  }

  admin.style.display = "block";

  onValue(convidadosRef, (snapshot) => {
    lista.innerHTML = "";

    snapshot.forEach((c) => {
      const li = document.createElement("li");
      li.textContent = `${c.val().nome} - ${c.val().resposta} `;

      const btn = document.createElement("button");
      btn.textContent = "âŒ";
      btn.onclick = () => remove(ref(db, "convidados/" + c.key));

      li.appendChild(btn);
      lista.appendChild(li);
    });
  });
};
</script>
